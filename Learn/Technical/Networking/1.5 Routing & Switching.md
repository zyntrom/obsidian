# ğŸ”¥ **1.5 Routing & Switching â€” FULL DETAILED EXPLANATION**

---

# ğŸŸ¦ **1. Switching (Layer 2 â€“ Ethernet)**

Switches operate at **Layer 2 (Data Link)** of the OSI model.

They forward traffic based on **MAC addresses**, not IP addresses.

---

## âœ… **How a Switch Works**

### **1. Learns MAC addresses**

The switch builds a **MAC Address Table**:

|MAC Address|Port|
|---|---|
|AA:BB:CC:11:22:33|Port 1|
|00:11:22:33:44:55|Port 3|

Example:  
If a PC on **Port 1** sends traffic, the switch learns:

`AA:BB:CC:11:22:33 â†’ Port 1`

---

### **2. Forwards only where needed**

Switch checks destination MAC and forwards **only out the correct port**.

Example:

- PC1 wants to send to PC2
- Switch sees MAC table
- Sends ONLY to PC2â€™s port
- No other device sees the traffic

â¡ï¸ This makes switches much safer than hubs.

---

## ğŸ’€ Hacker Attacks on Switches

### **1. ARP Spoofing / Poisoning**

Attacker sends fake ARP replies:

```
"I am the gateway. My MAC = aa:bb:cc:dd:ee:ff"
```

Victim updates ARP cache and sends all traffic to attacker.

â¡ï¸ Attacker becomes **Man-in-the-Middle (MitM)**.

---

### **2. MAC Flooding**

Attacker floods the switch with thousands of fake MAC addresses:

```
macchanger --random hping3 --flood ...
```

Switch MAC table overflows â†’ it enters **"hub-mode"**.

â¡ï¸ It broadcasts all traffic â†’ attacker can sniff all packets.

---

# ğŸŸ¦ **2. Routing (Layer 3 â€“ IP)**

Routers operate at **Layer 3 (Network)** and use **IP addresses**.

They forward packets **between networks**, not inside a LAN.

---

## ğŸ§­ Routing Table Example (Explained)

`Destination: 192.168.5.0 Mask: 255.255.255.0 Gateway: 192.168.1.1 Interface: eth0`

### Breakdown:

|Field|Meaning|
|---|---|
|**Destination**|Target network you want to reach|
|**Mask**|Defines network size (255.255.255.0 = /24)|
|**Gateway**|Next hop router to reach that network|
|**Interface**|The exit interface (e.g., eth0)|

### Example Scenario

Your PC wants to reach:

`192.168.5.25`

Router checks routing table â†’ matches the route 192.168.5.0/24  
Forwards packet to **gateway 192.168.1.1** through **eth0**.

Routers forward based on **best match**.

---

# ğŸŸ¦ **3. Default Gateway (VERY IMPORTANT)**

If destination IP is **outside your local network**, your device sends it to the **default gateway**.

Example:

Your PC:

`IP: 192.168.1.10 Gateway: 192.168.1.1`

You want to visit Google:

`142.250.183.142`

This IP is **not in your LAN**, so your PC sends the packet â†’ **default gateway** â†’ Internet.

---

## ğŸ’€ Attack: Fake Gateway

Attacker sends ARP spoof claiming:

`Gateway IP: 192.168.1.1 Attacker MAC: aa:bb:cc:dd:ee:ff`

Devices think the attacker is the router.

â¡ï¸ **Attacker receives ALL internet-bound traffic**  
â¡ï¸ Can do:

- MitM
    
- Stealing passwords
    
- DNS spoofing
    
- SSL-strip
    

---

# ğŸŸ¦ **4. ARP (Address Resolution Protocol)â€”DETAILED**

ARP works at **Layer 2** and translates:

`IP Address â†’ MAC Address`

---

## âš™ï¸ How ARP Works (Example)

PC1 (192.168.1.10) wants to talk to PC2 (192.168.1.20).

PC1 sends:

`"Who has 192.168.1.20? Tell 192.168.1.10"`

PC2 responds:

`"I am 192.168.1.20, my MAC is 00:11:22:33:44:55"`

PC1 stores this in ARP Cache:

`192.168.1.20 â†’ 00:11:22:33:44:55`

---

## â— ARP Weakness

- **NO authentication**
    
- Anyone can reply "I am the gateway" even if theyâ€™re not
    
- Devices believe the fake ARP message
    

---

## ğŸ’€ ARP Attacks

### **1. ARP Poisoning**

Attacker poisons victim + router:

- Tells victim: "I am the router"
    
- Tells router: "I am the victim"
    

â¡ï¸ Attacker sits in the middle = **MitM**

---

### **2. Session Hijacking**

Once attacker gets MitM:

- Captures cookies/session tokens
    
- Hijacks login sessions (Facebook, Gmail, etc.)
    

---

### **3. SSL-Strip**

Attacker forces victim to downgrade from **HTTPS â†’ HTTP**

Steals:

- Passwords
    
- Credit card info
    
- Session tokens
    

---

# ğŸŸ¦ **5. MAC Address (Media Access Control)**

- 48-bit unique hardware ID
    
- Layer 2 identifier
    
- Format: `AA:BB:CC:DD:EE:FF`
    

Example:

`Intel NIC MAC â†’ A4:6B:C1:11:22:33`

---

## âš™ï¸ MAC Spoofing

Tools:

`macchanger -r eth0 ifconfig eth0 hw ether <new MAC> ip link set dev eth0 address <new MAC>`

### Why spoof MAC?

- Bypass WiFi MAC filtering
    
- Hide device identity
    
- Conduct attacks anonymously
    
- Generate millions of fake MACs for MAC flooding
    

---

# ğŸŸ© **Complete Example Attack Scenario**

### Attacker Goal: Sniff all traffic inside LAN

Steps:

1. **Spoof MAC**
    
    `macchanger -r eth0`
    
2. **Send ARP poisoning packets**
    
    `arpspoof -t 192.168.1.10 192.168.1.1 arpspoof -t 192.168.1.1 192.168.1.10`
    
3. Victim sends all packets â†’ attacker
    
4. Attacker enables packet forwarding
    
    `echo 1 > /proc/sys/net/ipv4/ip_forward`
    
5. Open Wireshark â†’ captures everything
    
6. Optional: run **ssl-strip**
    

Attacker can now:

- Read emails
    
- Grab passwords
    
- Hijack sessions
    
- Monitor traffic